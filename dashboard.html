<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <!-- Include any necessary CSS and JavaScript libraries for charting -->
    <link rel="stylesheet" type="text/css" href="styles.css">
    <!-- Include Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <!-- For example, you might use Chart.js for charting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
</head>
<body>

<!-- Navigation menu -->
<nav>
    <ul>
        <li><a href="#">Home</a></li>
        <li><a href="create_member.html">Create New User</a></li>
        <li><a href="create_loan.html"">Create New Loan</a></li>
        <li><a href="logout.php">Logout</a></li>
    </ul>
</nav>

<!-- Dashboard header -->
<h2>Dashboard</h2>

<!-- Charts section -->
<div id="charts">
    <!-- Charts for loans issued over different time periods -->
    <div class="chart-container">
        <h3>Loans Issued</h3>
        <canvas id="loansChart" width="400" height="200"></canvas>
        <button onclick="downloadChart('loans-chart')">Download Chart</button>
    </div>

    <!-- Charts for top borrowers -->
    <div class="chart-container">
        <h3>Top Borrowers</h3>
        <canvas id="top-borrowers-chart" width="400" height="200"></canvas>
        <button onclick="downloadChart('top-borrowers-chart')">Download Chart</button>
    </div>

    <!-- Charts for loans in arrears -->
    <div class="chart-container">
        <h3>Loans in Arrears</h3>
        <canvas id="arrears-chart" width="400" height="200"></canvas>
        <button onclick="downloadChart('arrears-chart')">Download Chart</button>
    </div>

    <!-- Charts for all loans -->
    <div class="chart-container">
        <h3>All Loans</h3>
        <canvas id="all-loans-chart" width="400" height="200"></canvas>
        <button onclick="downloadChart('all-loans-chart')">Download Chart</button>
    </div>
</div>

<script>
    // JavaScript code for charting and downloading charts goes here
    // You need to write JavaScript functions to fetch data from the server
    // and create charts using Chart.js library
    // JavaScript
fetch('scripts/fetch_data.php')
    .then(response => response.json())
    .then(data => {
        const ctx = document.getElementById('loansChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(item => item.loan_date),
                datasets: [{
                    label: 'Loans Issued',
                    data: data.map(item => item.loan_amount),
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });

    // Function to download the chart as an image
    function downloadChart(canvasId) {
        var canvas = document.getElementById(canvasId);
        var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
        var link = document.createElement('a');
        link.download = 'chart.png';
        link.href = image;
        link.click();
    }
</script>

<table id="loansTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Amount</th>
            <th>Balance</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows will be added here dynamically -->
    </tbody>
</table>

    <script>
        // JavaScript code to fetch loans data and populate the table
    fetch('scripts/fetch_loans.php')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.getElementById('loansTable').getElementsByTagName('tbody')[0];
            data.forEach(loan => {
                const newRow = tableBody.insertRow();
                newRow.innerHTML = `
                    <td>${loan.date}</td>
                    <td>${loan.amount}</td>
                    <td>${loan.balance}</td>
                    <td>${loan.status}</td>
                `;
            });
        });
    </script>
</body>
</html>
